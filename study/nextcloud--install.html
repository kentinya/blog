<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="安装Nginx 见NGINX&ndash;安装小结。 Nginx配置文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 upstream php-handler { #server 127."><title>nextcloud 安装及调优教程</title>
<link rel=canonical href=https://blog.freenet.lol/study/nextcloud--install.html><link rel=stylesheet href=/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="nextcloud 安装及调优教程"><meta property='og:description' content="安装Nginx 见NGINX&ndash;安装小结。 Nginx配置文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 upstream php-handler { #server 127."><meta property='og:url' content='https://blog.freenet.lol/study/nextcloud--install.html'><meta property='og:site_name' content='懒人日记'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Linux'><meta property='article:published_time' content='2024-07-13T00:00:00+00:00'><meta property='article:modified_time' content='2024-07-13T00:00:00+00:00'><meta property='og:image' content='https://blog.freenet.lol/cover.jpg'><meta name=twitter:title content="nextcloud 安装及调优教程"><meta name=twitter:description content="安装Nginx 见NGINX&ndash;安装小结。 Nginx配置文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 upstream php-handler { #server 127."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.freenet.lol/cover.jpg'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hud9476a24cdfc56e31885c5342329b601_33267_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>懒人日记</a></h1><h2 class=site-description>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2></div></header><ol class=menu-social><li><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#安装nginx>安装Nginx</a></li><li><a href=#安装php>安装PHP</a></li><li><a href=#安装mariadb>安装MariaDB</a></li><li><a href=#redis安装>Redis安装</a></li><li><a href=#安装nextcloud>安装nextcloud</a></li><li><a href=#修改配置文件>修改配置文件</a></li><li><a href=#cron调优>cron调优</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/study/nextcloud--install.html><img src=/cover.jpg loading=lazy alt="Featured image of post nextcloud 安装及调优教程"></a></div><div class=article-details><header class=article-category><a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>学习笔记</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/study/nextcloud--install.html>nextcloud 安装及调优教程</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 13, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 7 分钟</time></div></footer></div></header><section class=article-content><h2 id=安装nginx>安装Nginx</h2><p>见<a class=link href=https://blog.freenet.lol/study/NGINX--install.html target=_blank rel=noopener>NGINX&ndash;安装</a>小结。</p><p><strong>Nginx配置文件</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>upstream</span> <span class=n>php</span><span class=o>-</span><span class=n>handler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>#server 127.0.0.1:9000;</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span> <span class=n>unix</span><span class=p>:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>php</span><span class=o>/</span><span class=n>php8</span><span class=o>.</span><span class=mi>2</span><span class=o>-</span><span class=n>fpm</span><span class=o>.</span><span class=n>sock</span><span class=p>;</span><span class=c1>## 改为php版本</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set the `immutable` cache control options only for assets with a cache busting `v` argument</span>
</span></span><span class=line><span class=cl><span class=n>map</span> <span class=o>$</span><span class=n>arg_v</span> <span class=o>$</span><span class=n>asset_immutable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span> <span class=s2>&#34;, immutable&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>listen</span> <span class=p>[::]:</span><span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>server_name</span> <span class=n>cloud</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Prevent nginx HTTP Server Detection</span>
</span></span><span class=line><span class=cl>    <span class=n>server_tokens</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Enforce HTTPS</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>301</span> <span class=n>https</span><span class=p>:</span><span class=o>//$</span><span class=n>server_name</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>listen</span> <span class=mi>443</span>      <span class=n>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>listen</span> <span class=p>[::]:</span><span class=mi>443</span> <span class=n>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>http2</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>server_name</span> <span class=n>cloud</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Path to the root of your installation</span>
</span></span><span class=line><span class=cl>    <span class=n>root</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>nextcloud</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Use Mozilla&#39;s guidelines for SSL/TLS settings</span>
</span></span><span class=line><span class=cl>    <span class=c1># https://mozilla.github.io/server-side-tls/ssl-config-generator/</span>
</span></span><span class=line><span class=cl>    <span class=n>ssl_certificate</span>     <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssl</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>cloud</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>.</span><span class=n>crt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ssl_certificate_key</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssl</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>cloud</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>.</span><span class=n>key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ssl_trusted_certificate</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>ssl</span><span class=o>/***/***.</span><span class=n>ca</span><span class=o>.</span><span class=n>crt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Prevent nginx HTTP Server Detection</span>
</span></span><span class=line><span class=cl>    <span class=n>server_tokens</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># HSTS settings</span>
</span></span><span class=line><span class=cl>    <span class=c1># WARNING: Only add the preload option once you read about</span>
</span></span><span class=line><span class=cl>    <span class=c1># the consequences in https://hstspreload.org/. This option</span>
</span></span><span class=line><span class=cl>    <span class=c1># will add the domain to a hardcoded list that is shipped</span>
</span></span><span class=line><span class=cl>    <span class=c1># in all major browsers and getting removed from this list</span>
</span></span><span class=line><span class=cl>    <span class=c1># could take several months.</span>
</span></span><span class=line><span class=cl>    <span class=n>add_header</span> <span class=n>Strict</span><span class=o>-</span><span class=n>Transport</span><span class=o>-</span><span class=n>Security</span> <span class=s2>&#34;max-age=15768000; includeSubDomains; preload&#34;</span> <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># set max upload size and increase upload timeout:</span>
</span></span><span class=line><span class=cl>    <span class=n>client_max_body_size</span> <span class=mi>512</span><span class=n>M</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>client_body_timeout</span> <span class=mi>300</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>fastcgi_buffers</span> <span class=mi>64</span> <span class=mi>4</span><span class=n>K</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Enable gzip but do not remove ETag headers</span>
</span></span><span class=line><span class=cl>    <span class=n>gzip</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>gzip_vary</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>gzip_comp_level</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>gzip_min_length</span> <span class=mi>256</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>gzip_proxied</span> <span class=n>expired</span> <span class=n>no</span><span class=o>-</span><span class=n>cache</span> <span class=n>no</span><span class=o>-</span><span class=n>store</span> <span class=n>private</span> <span class=n>no_last_modified</span> <span class=n>no_etag</span> <span class=n>auth</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>gzip_types</span> <span class=n>application</span><span class=o>/</span><span class=n>atom</span><span class=o>+</span><span class=n>xml</span> <span class=n>text</span><span class=o>/</span><span class=n>javascript</span> <span class=n>application</span><span class=o>/</span><span class=n>javascript</span> <span class=n>application</span><span class=o>/</span><span class=n>json</span> <span class=n>application</span><span class=o>/</span><span class=n>ld</span><span class=o>+</span><span class=n>json</span> <span class=n>application</span><span class=o>/</span><span class=n>manifest</span><span class=o>+</span><span class=n>json</span> <span class=n>application</span><span class=o>/</span><span class=n>rss</span><span class=o>+</span><span class=n>xml</span> <span class=n>application</span><span class=o>/</span><span class=n>vnd</span><span class=o>.</span><span class=n>geo</span><span class=o>+</span><span class=n>json</span> <span class=n>application</span><span class=o>/</span><span class=n>vnd</span><span class=o>.</span><span class=n>ms</span><span class=o>-</span><span class=n>fontobject</span> <span class=n>application</span><span class=o>/</span><span class=n>wasm</span> <span class=n>application</span><span class=o>/</span><span class=n>x</span><span class=o>-</span><span class=n>font</span><span class=o>-</span><span class=n>ttf</span> <span class=n>application</span><span class=o>/</span><span class=n>x</span><span class=o>-</span><span class=n>web</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>manifest</span><span class=o>+</span><span class=n>json</span> <span class=n>application</span><span class=o>/</span><span class=n>xhtml</span><span class=o>+</span><span class=n>xml</span> <span class=n>application</span><span class=o>/</span><span class=n>xml</span> <span class=n>font</span><span class=o>/</span><span class=n>opentype</span> <span class=n>image</span><span class=o>/</span><span class=n>bmp</span> <span class=n>image</span><span class=o>/</span><span class=n>svg</span><span class=o>+</span><span class=n>xml</span> <span class=n>image</span><span class=o>/</span><span class=n>x</span><span class=o>-</span><span class=n>icon</span> <span class=n>text</span><span class=o>/</span><span class=n>cache</span><span class=o>-</span><span class=n>manifest</span> <span class=n>text</span><span class=o>/</span><span class=n>css</span> <span class=n>text</span><span class=o>/</span><span class=n>plain</span> <span class=n>text</span><span class=o>/</span><span class=n>vcard</span> <span class=n>text</span><span class=o>/</span><span class=n>vnd</span><span class=o>.</span><span class=n>rim</span><span class=o>.</span><span class=n>location</span><span class=o>.</span><span class=n>xloc</span> <span class=n>text</span><span class=o>/</span><span class=n>vtt</span> <span class=n>text</span><span class=o>/</span><span class=n>x</span><span class=o>-</span><span class=n>component</span> <span class=n>text</span><span class=o>/</span><span class=n>x</span><span class=o>-</span><span class=n>cross</span><span class=o>-</span><span class=n>domain</span><span class=o>-</span><span class=n>policy</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Pagespeed is not supported by Nextcloud, so if your server is built</span>
</span></span><span class=line><span class=cl>    <span class=c1># with the `ngx_pagespeed` module, uncomment this line to disable it.</span>
</span></span><span class=line><span class=cl>    <span class=c1>#pagespeed off;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># The settings allows you to optimize the HTTP2 bandwidth.</span>
</span></span><span class=line><span class=cl>    <span class=c1># See https://blog.cloudflare.com/delivering-http-2-upload-speed-improvements/</span>
</span></span><span class=line><span class=cl>    <span class=c1># for tuning hints</span>
</span></span><span class=line><span class=cl>    <span class=n>client_body_buffer_size</span> <span class=mi>512</span><span class=n>k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># HTTP response headers borrowed from Nextcloud `.htaccess`</span>
</span></span><span class=line><span class=cl>    <span class=n>add_header</span> <span class=n>Referrer</span><span class=o>-</span><span class=n>Policy</span>                   <span class=s2>&#34;no-referrer&#34;</span>       <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=o>-</span><span class=n>Options</span>            <span class=s2>&#34;nosniff&#34;</span>           <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Frame</span><span class=o>-</span><span class=n>Options</span>                   <span class=s2>&#34;SAMEORIGIN&#34;</span>        <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Permitted</span><span class=o>-</span><span class=n>Cross</span><span class=o>-</span><span class=n>Domain</span><span class=o>-</span><span class=n>Policies</span> <span class=s2>&#34;none&#34;</span>              <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Robots</span><span class=o>-</span><span class=n>Tag</span>                      <span class=s2>&#34;noindex, nofollow&#34;</span> <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>XSS</span><span class=o>-</span><span class=n>Protection</span>                  <span class=s2>&#34;1; mode=block&#34;</span>     <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Remove X-Powered-By, which is an information leak</span>
</span></span><span class=line><span class=cl>    <span class=n>fastcgi_hide_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Powered</span><span class=o>-</span><span class=n>By</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Set .mjs and .wasm MIME types</span>
</span></span><span class=line><span class=cl>    <span class=c1># Either include it in the default mime.types list</span>
</span></span><span class=line><span class=cl>    <span class=c1># and include that list explicitly or add the file extension</span>
</span></span><span class=line><span class=cl>    <span class=c1># only for Nextcloud like below:</span>
</span></span><span class=line><span class=cl>    <span class=n>include</span> <span class=n>mime</span><span class=o>.</span><span class=n>types</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>types</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>text</span><span class=o>/</span><span class=n>javascript</span> <span class=n>js</span> <span class=n>mjs</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>application</span><span class=o>/</span><span class=n>wasm</span> <span class=n>wasm</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Specify how to handle directories -- specifying `/index.php$request_uri`</span>
</span></span><span class=line><span class=cl>    <span class=c1># here as the fallback means that Nginx always exhibits the desired behaviour</span>
</span></span><span class=line><span class=cl>    <span class=c1># when a client requests a path that corresponds to a directory that exists</span>
</span></span><span class=line><span class=cl>    <span class=c1># on the server. In particular, if that directory contains an index.php file,</span>
</span></span><span class=line><span class=cl>    <span class=c1># that file is correctly served; if it doesn&#39;t, then the request is passed to</span>
</span></span><span class=line><span class=cl>    <span class=c1># the front-end controller. This consistent behaviour means that we don&#39;t need</span>
</span></span><span class=line><span class=cl>    <span class=c1># to specify custom rules for certain paths (e.g. images and other assets,</span>
</span></span><span class=line><span class=cl>    <span class=c1># `/updater`, `/ocs-provider`), and thus</span>
</span></span><span class=line><span class=cl>    <span class=c1># `try_files $uri $uri/ /index.php$request_uri`</span>
</span></span><span class=line><span class=cl>    <span class=c1># always provides the desired behaviour.</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=n>index</span><span class=o>.</span><span class=n>php</span> <span class=n>index</span><span class=o>.</span><span class=n>html</span> <span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Rule borrowed from `.htaccess` to handle Microsoft DAV clients</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>=</span> <span class=o>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=o>$</span><span class=n>http_user_agent</span> <span class=o>~</span> <span class=o>^</span><span class=n>DavClnt</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>302</span> <span class=o>/</span><span class=n>remote</span><span class=o>.</span><span class=n>php</span><span class=o>/</span><span class=n>webdav</span><span class=o>/$</span><span class=n>is_args</span><span class=o>$</span><span class=n>args</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>=</span> <span class=o>/</span><span class=n>robots</span><span class=o>.</span><span class=n>txt</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>allow</span> <span class=n>all</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>log_not_found</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>access_log</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Make a regex exception for `/.well-known` so that clients can still</span>
</span></span><span class=line><span class=cl>    <span class=c1># access it despite the existence of the regex rule</span>
</span></span><span class=line><span class=cl>    <span class=c1># `location ~ /(\.|autotest|...)` which would otherwise handle requests</span>
</span></span><span class=line><span class=cl>    <span class=c1># for `/.well-known`.</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>^~</span> <span class=o>/.</span><span class=n>well</span><span class=o>-</span><span class=n>known</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># The rules in this block are an adaptation of the rules</span>
</span></span><span class=line><span class=cl>        <span class=c1># in `.htaccess` that concern `/.well-known`.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>location</span> <span class=o>=</span> <span class=o>/.</span><span class=n>well</span><span class=o>-</span><span class=n>known</span><span class=o>/</span><span class=n>carddav</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>301</span> <span class=o>/</span><span class=n>remote</span><span class=o>.</span><span class=n>php</span><span class=o>/</span><span class=n>dav</span><span class=o>/</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>location</span> <span class=o>=</span> <span class=o>/.</span><span class=n>well</span><span class=o>-</span><span class=n>known</span><span class=o>/</span><span class=n>caldav</span>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>301</span> <span class=o>/</span><span class=n>remote</span><span class=o>.</span><span class=n>php</span><span class=o>/</span><span class=n>dav</span><span class=o>/</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>location</span> <span class=o>/.</span><span class=n>well</span><span class=o>-</span><span class=n>known</span><span class=o>/</span><span class=n>acme</span><span class=o>-</span><span class=n>challenge</span>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>            <span class=n>try_files</span> <span class=o>$</span><span class=n>uri</span> <span class=o>$</span><span class=n>uri</span><span class=o>/</span> <span class=o>=</span><span class=mi>404</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>location</span> <span class=o>/.</span><span class=n>well</span><span class=o>-</span><span class=n>known</span><span class=o>/</span><span class=n>pki</span><span class=o>-</span><span class=n>validation</span>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>            <span class=n>try_files</span> <span class=o>$</span><span class=n>uri</span> <span class=o>$</span><span class=n>uri</span><span class=o>/</span> <span class=o>=</span><span class=mi>404</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Let Nextcloud&#39;s API for `/.well-known` URIs handle all other</span>
</span></span><span class=line><span class=cl>        <span class=c1># requests by passing them to the front-end controller.</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>301</span> <span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Rules borrowed from `.htaccess` to hide certain paths from clients</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>~</span> <span class=o>^/</span><span class=p>(</span><span class=err>?</span><span class=p>:</span><span class=n>build</span><span class=o>|</span><span class=n>tests</span><span class=o>|</span><span class=n>config</span><span class=o>|</span><span class=n>lib</span><span class=o>|</span><span class=mi>3</span><span class=n>rdparty</span><span class=o>|</span><span class=n>templates</span><span class=o>|</span><span class=n>data</span><span class=p>)(</span><span class=err>?</span><span class=p>:</span><span class=o>$|/</span><span class=p>)</span>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>404</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>~</span> <span class=o>^/</span><span class=p>(</span><span class=err>?</span><span class=p>:</span>\<span class=o>.|</span><span class=n>autotest</span><span class=o>|</span><span class=n>occ</span><span class=o>|</span><span class=n>issue</span><span class=o>|</span><span class=n>indie</span><span class=o>|</span><span class=n>db_</span><span class=o>|</span><span class=n>console</span><span class=p>)</span>                <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>404</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Ensure this block, which passes PHP files to the PHP process, is above the blocks</span>
</span></span><span class=line><span class=cl>    <span class=c1># which handle static assets (as seen below). If this block is not declared first,</span>
</span></span><span class=line><span class=cl>    <span class=c1># then Nginx will encounter an infinite rewriting loop when it prepends `/index.php`</span>
</span></span><span class=line><span class=cl>    <span class=c1># to the URI, resulting in a HTTP 500 error response.</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>~</span> \<span class=o>.</span><span class=n>php</span><span class=p>(</span><span class=err>?</span><span class=p>:</span><span class=o>$|/</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># Required for legacy support</span>
</span></span><span class=line><span class=cl>        <span class=n>rewrite</span> <span class=o>^/</span><span class=p>(</span><span class=err>?</span><span class=o>!</span><span class=n>index</span><span class=o>|</span><span class=n>remote</span><span class=o>|</span><span class=n>public</span><span class=o>|</span><span class=n>cron</span><span class=o>|</span><span class=n>core</span>\<span class=o>/</span><span class=n>ajax</span>\<span class=o>/</span><span class=n>update</span><span class=o>|</span><span class=n>status</span><span class=o>|</span><span class=n>ocs</span>\<span class=o>/</span><span class=n>v</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span><span class=o>|</span><span class=n>updater</span>\<span class=o>/.+|</span><span class=n>ocs</span><span class=o>-</span><span class=n>provider</span>\<span class=o>/.+|.+</span>\<span class=o>/</span><span class=n>richdocumentscode</span><span class=p>(</span><span class=n>_arm64</span><span class=p>)</span><span class=err>?</span>\<span class=o>/</span><span class=n>proxy</span><span class=p>)</span> <span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_split_path_info</span> <span class=o>^</span><span class=p>(</span><span class=o>.+</span><span class=err>?</span>\<span class=o>.</span><span class=n>php</span><span class=p>)(</span><span class=o>/.*</span><span class=p>)</span><span class=o>$</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>set</span> <span class=o>$</span><span class=n>path_info</span> <span class=o>$</span><span class=n>fastcgi_path_info</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>try_files</span> <span class=o>$</span><span class=n>fastcgi_script_name</span> <span class=o>=</span><span class=mi>404</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>include</span> <span class=n>fastcgi_params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_param</span> <span class=n>SCRIPT_FILENAME</span> <span class=o>$</span><span class=n>document_root</span><span class=o>$</span><span class=n>fastcgi_script_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_param</span> <span class=n>PATH_INFO</span> <span class=o>$</span><span class=n>path_info</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_param</span> <span class=n>HTTPS</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_param</span> <span class=n>modHeadersAvailable</span> <span class=bp>true</span><span class=p>;</span>         <span class=c1># Avoid sending the security headers twice</span>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_param</span> <span class=n>front_controller_active</span> <span class=bp>true</span><span class=p>;</span>     <span class=c1># Enable pretty urls</span>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_pass</span> <span class=n>php</span><span class=o>-</span><span class=n>handler</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_intercept_errors</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_request_buffering</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fastcgi_max_temp_file_size</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Serve static files</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>~</span> \<span class=o>.</span><span class=p>(</span><span class=err>?</span><span class=p>:</span><span class=n>css</span><span class=o>|</span><span class=n>js</span><span class=o>|</span><span class=n>mjs</span><span class=o>|</span><span class=n>svg</span><span class=o>|</span><span class=n>gif</span><span class=o>|</span><span class=n>png</span><span class=o>|</span><span class=n>jpg</span><span class=o>|</span><span class=n>ico</span><span class=o>|</span><span class=n>wasm</span><span class=o>|</span><span class=n>tflite</span><span class=o>|</span><span class=n>map</span><span class=o>|</span><span class=n>ogg</span><span class=o>|</span><span class=n>flac</span><span class=p>)</span><span class=o>$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>try_files</span> <span class=o>$</span><span class=n>uri</span> <span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1># HTTP response headers borrowed from Nextcloud `.htaccess`</span>
</span></span><span class=line><span class=cl>        <span class=n>add_header</span> <span class=n>Cache</span><span class=o>-</span><span class=ne>Control</span>                     <span class=s2>&#34;public, max-age=15778463$asset_immutable&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>add_header</span> <span class=n>Referrer</span><span class=o>-</span><span class=n>Policy</span>                   <span class=s2>&#34;no-referrer&#34;</span>       <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=o>-</span><span class=n>Options</span>            <span class=s2>&#34;nosniff&#34;</span>           <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Frame</span><span class=o>-</span><span class=n>Options</span>                   <span class=s2>&#34;SAMEORIGIN&#34;</span>        <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Permitted</span><span class=o>-</span><span class=n>Cross</span><span class=o>-</span><span class=n>Domain</span><span class=o>-</span><span class=n>Policies</span> <span class=s2>&#34;none&#34;</span>              <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Robots</span><span class=o>-</span><span class=n>Tag</span>                      <span class=s2>&#34;noindex, nofollow&#34;</span> <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>XSS</span><span class=o>-</span><span class=n>Protection</span>                  <span class=s2>&#34;1; mode=block&#34;</span>     <span class=n>always</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>access_log</span> <span class=n>off</span><span class=p>;</span>     <span class=c1># Optional: Don&#39;t log access to assets</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>~</span> \<span class=o>.</span><span class=n>woff2</span><span class=err>?</span><span class=o>$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>try_files</span> <span class=o>$</span><span class=n>uri</span> <span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>expires</span> <span class=mi>7</span><span class=n>d</span><span class=p>;</span>         <span class=c1># Cache-Control policy borrowed from `.htaccess`</span>
</span></span><span class=line><span class=cl>        <span class=n>access_log</span> <span class=n>off</span><span class=p>;</span>     <span class=c1># Optional: Don&#39;t log access to assets</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Rule borrowed from `.htaccess`</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>/</span><span class=n>remote</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>301</span> <span class=o>/</span><span class=n>remote</span><span class=o>.</span><span class=n>php</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>try_files</span> <span class=o>$</span><span class=n>uri</span> <span class=o>$</span><span class=n>uri</span><span class=o>/</span> <span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=安装php>安装PHP</h2><p>见<a class=link href=https://blog.freenet.lol/study/PHP--install.html target=_blank rel=noopener>PHP&ndash;安装</a></p><p><strong>PHP调优</strong></p><ol><li>安装额外php模块</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt -y install php8.3-imagick php8.3-redis php8.3-apcu php8.3-gmp libmagickcore-6.q16-6-extra ffmpeg  
</span></span></code></pre></td></tr></table></div></div><p><code>libmagickcore-6.q16-6-extra</code>是为了是imagick具有处理svg能力。</p><ol start=2><li>调整 PHP 的进程数</li></ol><p>位于<code>fpm/pool.d/www.conf</code>下。</p><p><a class=link href=https://spot13.com/pmcalculator/ target=_blank rel=noopener>计算pm</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>pm</span> <span class=o>=</span> dynamic
</span></span><span class=line><span class=cl>pm.max_children <span class=o>=</span> <span class=m>120</span>
</span></span><span class=line><span class=cl>pm.start_servers <span class=o>=</span> <span class=m>12</span>
</span></span><span class=line><span class=cl>pm.min_spare_servers <span class=o>=</span> <span class=m>6</span>
</span></span><span class=line><span class=cl>pm.max_spare_servers <span class=o>=</span> <span class=m>18</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=p>;</span>env<span class=o>[</span>HOSTNAME<span class=o>]</span> <span class=o>=</span> <span class=nv>$HOSTNAME</span>
</span></span><span class=line><span class=cl><span class=p>;</span>env<span class=o>[</span>PATH<span class=o>]</span> <span class=o>=</span> /usr/local/bin:/usr/bin:/bin
</span></span><span class=line><span class=cl><span class=p>;</span>env<span class=o>[</span>TMP<span class=o>]</span> <span class=o>=</span> /tmp
</span></span><span class=line><span class=cl><span class=p>;</span>env<span class=o>[</span>TMPDIR<span class=o>]</span> <span class=o>=</span> /tmp
</span></span><span class=line><span class=cl><span class=p>;</span>env<span class=o>[</span>TEMP<span class=o>]</span> <span class=o>=</span> /tmp
</span></span></code></pre></td></tr></table></div></div><p>改为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>env<span class=o>[</span>HOSTNAME<span class=o>]</span> <span class=o>=</span> <span class=nv>$HOSTNAME</span>
</span></span><span class=line><span class=cl>env<span class=o>[</span>PATH<span class=o>]</span> <span class=o>=</span> /usr/local/bin:/usr/bin:/bin
</span></span><span class=line><span class=cl>env<span class=o>[</span>TMP<span class=o>]</span> <span class=o>=</span> /tmp
</span></span><span class=line><span class=cl>env<span class=o>[</span>TMPDIR<span class=o>]</span> <span class=o>=</span> /tmp
</span></span><span class=line><span class=cl>env<span class=o>[</span>TEMP<span class=o>]</span> <span class=o>=</span> /tmp
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>调整php内存</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano /etc/php/8.3/fpm/php.ini
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>memory_limit</span> <span class=o>=</span> 4096M
</span></span><span class=line><span class=cl><span class=nv>upload_max_filesize</span> <span class=o>=</span> 10240M
</span></span><span class=line><span class=cl><span class=nv>post_max_size</span> <span class=o>=</span> 10240M
</span></span><span class=line><span class=cl>max_input_time <span class=m>3600</span>
</span></span><span class=line><span class=cl>max_execution_time <span class=m>3600</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opcache<span class=o>]</span> 段的末尾加入如下内容：
</span></span><span class=line><span class=cl>opcache.enable<span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>opcache.enable_cli<span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>opcache.interned_strings_buffer<span class=o>=</span><span class=m>16</span>
</span></span><span class=line><span class=cl>opcache.max_accelerated_files<span class=o>=</span><span class=m>10000</span>
</span></span><span class=line><span class=cl>opcache.memory_consumption<span class=o>=</span><span class=m>128</span>
</span></span><span class=line><span class=cl>opcache.save_comments<span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>opcache.revalidate_freq<span class=o>=</span><span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=安装mariadb>安装MariaDB</h2><p>见<a class=link href=https://blog.freenet.lol/study/MariaDB--install.html target=_blank rel=noopener>MariaDB&ndash;安装</a></p><p>可前往官网下载最新的数据库安装命令。</p><p><strong>MySQL 的性能调优</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano /etc/mysql/conf.d/mysql.cnf
</span></span></code></pre></td></tr></table></div></div><p>在这个文件内添加如下内容，注意是 mysqld，不是 mysql，你可以在这个文件内把 mysql 这一段删除再加入下面的内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>mysqld<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>innodb_buffer_pool_size</span><span class=o>=</span>1G
</span></span><span class=line><span class=cl><span class=nv>innodb_io_capacity</span><span class=o>=</span><span class=m>4000</span>
</span></span></code></pre></td></tr></table></div></div><p>重启mariadb</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl restart mariadb.service
</span></span></code></pre></td></tr></table></div></div><p><strong>建立数据库</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>CREATE DATABASE nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci<span class=p>;</span>
</span></span><span class=line><span class=cl>CREATE USER <span class=s1>&#39;nextcloud&#39;</span>@<span class=s1>&#39;localhost&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>GRANT ALL PRIVILEGES ON nextcloud.* TO <span class=s1>&#39;nextcloud&#39;</span>@<span class=s1>&#39;localhost&#39;</span> IDENTIFIED BY <span class=s1>&#39;password&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>FLUSH PRIVILEGES<span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=redis安装>Redis安装</h2><p>见<a class=link href=https://blog.freenet.lol/study/Redis--install.html target=_blank rel=noopener>Redis&ndash;安装</a></p><h2 id=安装nextcloud>安装nextcloud</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home
</span></span><span class=line><span class=cl>wget -O nextcloud.zip https://download.nextcloud.com/server/releases/latest.zip
</span></span><span class=line><span class=cl>unzip nextcloud.zip
</span></span><span class=line><span class=cl>chown -R www-data:www-data /home/nextcloud
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> -R /home/nextcloud
</span></span></code></pre></td></tr></table></div></div><h2 id=修改配置文件>修改配置文件</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$CONFIG</span> <span class=o>=</span> <span class=k>array</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;memcache.locking&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;\\OC\\Memcache\\Redis&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;memcache.local&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;\\OC\\Memcache\\APCu&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;memcache.distributed&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;\\OC\\Memcache\\Redis&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;redis&#39;</span> <span class=o>=&gt;</span> 
</span></span><span class=line><span class=cl>  <span class=k>array</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;host&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;port&#39;</span> <span class=o>=&gt;</span> <span class=mi>6379</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;timeout&#39;</span> <span class=o>=&gt;</span> <span class=mf>0.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;default_phone_region&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;US&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1># 增加视频预览,需要提前安装ffmpeg
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=s1>&#39;enabledPreviewProviders&#39;</span> <span class=o>=&gt;</span> 
</span></span><span class=line><span class=cl>  <span class=k>array</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\PNG&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>1</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\JPEG&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>2</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\GIF&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>3</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\HEIC&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>4</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\BMP&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>5</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\XBitmap&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>6</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\MP3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>7</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\TXT&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>8</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\MarkDown&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>9</span> <span class=o>=&gt;</span> <span class=s1>&#39;OC\\Preview\\Movie&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;skeletondirectory&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;default_language&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;zh_CN&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;default_locale&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;zh&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;maintenance_window_start&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=cron调优>cron调优</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>crontab -u www-data -e
</span></span><span class=line><span class=cl>*/5  *  *  *  * php --define apc.enable_cli<span class=o>=</span><span class=m>1</span> -f  /home/nextcloud/cron.php 
</span></span><span class=line><span class=cl>crontab -u www-data -l
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/linux/>Linux</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 懒人日记</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>